@(user: Option[User])
@wrapper(user) {
<div id="screen" class="screen"></div>
<input type="text" id="text">
<input type="button" id="sayButton" value="say">
<input type="button" id="chatButton" value="chat">
<script>
	var el = function(id) { return document.getElementById(id) };
	var chat = function() {
		var message = {};
		var text = el('text').value;
		if (text.charAt(0) == '!')
			message.newLocation = text.substring(1);
		else
			message.chat = text;
		sendMessage(message);
		el('text').value = "";
	};
	el("chatButton").onclick = chat;
	var say = function() {
		var text = el('text').value;
		sendMessage({ say: text });
		el('text').value = "";
	};
	el("sayButton").onclick = say;
	el("text").onkeydown = function(event) {
		if (event.keyCode == 13)
			say();
	};
	var receive = function(message) {
		var msg = JSON.parse(message.data);
		if (msg.newLocation) {
			document.title = msg.newLocation;
			return;
		}
		if (msg.move) {
			getPlayer().body.x = msg.move.x;
			getPlayer().body.y = msg.move.y;
			return;
		}
		var entry = msg.isOwner ? "<b>" + msg.user + "</b>" : msg.user;
		if (msg.chat)
			entry += " chats: " + msg.chat + "<br>";
		if (msg.say)
			entry += " says: " + msg.say + "<br>";
		el("screen").innerHTML += entry;
	};

	var game = new Phaser.Game(800, 600, Phaser.CANVAS, '');
		game.state.add('Load', GameStates.Load);
		game.state.add('MainMenu', GameStates.MainMenu);
		game.state.add('MainGame', GameStates.MainGame);
		game.state.start('Load');
	@if(user.isDefined) {
		var playerStartPosition = [@user.get.xy._1, @user.get.xy._2];
	}
	connect('socket', receive);
</script>
}
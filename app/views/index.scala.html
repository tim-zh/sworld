@(user: Option[User])
@wrapper(user) {
  <div id="screen" class="screen"></div>
  <input type="text" id="text">
  <input type="button" id="sayButton" value="say">
  <input type="button" id="chatButton" value="chat">
  <input type="button" id="upButton" value="up">
  <input type="button" id="downButton" value="down">
  <input type="button" id="leftButton" value="left">
  <input type="button" id="rightButton" value="right">
  <script>
	  var game = new Phaser.Game(800, 600, Phaser.CANVAS, '');
	  game.state.add('Load', GameStates.Load);
	  game.state.add('MainMenu', GameStates.MainMenu);
	  game.state.add('MainGame', GameStates.MainGame);
	  game.state.start('Load');

    var el = function(id) { return document.getElementById(id) };
    var chat = function() {
      var message = {};
      var text = el('text').value;
      if (text.charAt(0) == '!')
        message.newLocation = text.substring(1);
      else
        message.chat = text;
      sendMessage(message);
      el('text').value = "";
    };
    el("chatButton").onclick = chat;
    var say = function() {
      var text = el('text').value;
      sendMessage({ say: text });
      el('text').value = "";
    };
    el("sayButton").onclick = say;
    el("text").onkeydown = function(event) {
      if (event.keyCode == 13)
        say();
    };
    var x = 1;
    var y = 1;
    var move = function(direction) {
      switch (direction) {
        case "up":
          y -= 1;
          break;
        case "down":
          y += 1;
          break;
        case "left":
          x -= 1;
          break;
        case "right":
          x += 1;
          break;
      }
      sendMessage({ move: { x: x, y: y } });
    };
    el("upButton").onclick = function() { move("up") };
    el("downButton").onclick = function() { move("down") };
    el("leftButton").onclick = function() { move("left") };
    el("rightButton").onclick = function() { move("right") };
    var receive = function(message) {
      var msg = JSON.parse(message.data);
      if (msg.newLocation) {
        document.title = msg.newLocation;
        return;
      }
      if (msg.move) {
        x = msg.move.x;
        y = msg.move.y;
        document.getElementById("screen").innerHTML += "moved to x: " + x + " y: " + y + "<br/>";
        return;
      }
      var entry = msg.isOwner ? "<b>" + msg.user + "</b>" : msg.user;
      if (msg.chat)
        entry += " chats: " + msg.chat + "<br>";
      if (msg.say)
        entry += " says: " + msg.say + "<br>";
      el("screen").innerHTML += entry;
    };
    connect('socket', receive);
  </script>
}